!function($){var methods={init:function(e){var l=$(this).prop("id");null!=(e=$.extend({columns:[],colHeaders:[],colWidths:[],colAlignments:[],colHeaderClasses:[],defaultColWidth:50,minSpareRows:0,minSpareCols:0,minDimensions:[0,0],contextMenu:null,columnSorting:!0,columnResize:!0,rowDrag:!0,editable:!0,allowInsertRow:!0,allowManualInsertRow:!0,allowInsertColumn:!0,allowManualInsertColumn:!0,allowDeleteRow:!0,allowDeleteColumn:!0,wordWrap:!1,tableId:null,csvFileName:"jexcel",selectionCopy:!0,about:"jExcel Spreadsheet\\nVersion 1.5.0\\nAuthor: Paul Hodel <paul.hodel@gmail.com>\\nWebsite: https://bossanova.uk/jexcel"},e)).manualColumnResize&&(e.columnResize=e.manualColumnResize),null!=e.manualRowMove&&(e.rowDrag=e.manualRowMove),$.fn.jexcel.defaults||($.fn.jexcel.ignoreEvents=!1,$.fn.jexcel.ignoreHistory=!1,$.fn.jexcel.defaults=[]),$.fn.jexcel.defaults[l]=e,$.fn.jexcel.defaults[l].data||($.fn.jexcel.defaults[l].data=[]),$.fn.jexcel.defaults[l].data.length||($.fn.jexcel.defaults[l].data=[[]]),$.fn.jexcel.defaults[l].history=[],$.fn.jexcel.defaults[l].historyIndex=-1,$.fn.jexcel.defaults[l].csv?$.csv?($.fn.jexcel.defaults[l].delimiter=$.fn.jexcel.defaults[l].delimiter||",",$.ajax({id:l,url:$.fn.jexcel.defaults[l].csv,success:function(e){var l=$.csv.toArrays(e);1==$.fn.jexcel.defaults[this.id].csvHeaders&&($.fn.jexcel.defaults[this.id].colHeaders=l.shift()),$.fn.jexcel.defaults[this.id].data=l,$.fn.jexcel("prepareTable",this.id)}})):console.error("Jexcel error: jquery-csv library not loaded"):e.url?$.ajax({id:l,url:$.fn.jexcel.defaults[l].url,dataType:"json",success:function(e){$.fn.jexcel.defaults[this.id].data=e.data?e.data:e,$.fn.jexcel("prepareTable",this.id)}}):$.fn.jexcel("prepareTable",l)},prepareTable:function(e){var l=[],t=$.fn.jexcel.defaults[e].colHeaders.length;$.fn.jexcel.defaults[e].data[0].length>t&&(t=$.fn.jexcel.defaults[e].data[0].length),$.fn.jexcel.defaults[e].minDimensions[0]>t&&(t=$.fn.jexcel.defaults[e].minDimensions[0]);for(var n=0;n<t;n++)$.fn.jexcel.defaults[e].colHeaders[n]||($.fn.jexcel.defaults[e].colHeaders[n]=""),$.fn.jexcel.defaults[e].columns[n]?$.fn.jexcel.defaults[e].columns[n]||($.fn.jexcel.defaults[e].columns[n].type="text"):$.fn.jexcel.defaults[e].columns[n]={type:"text"},$.fn.jexcel.defaults[e].columns[n].source||($.fn.jexcel.defaults[e].columns[n].source=[]),$.fn.jexcel.defaults[e].columns[n].options||($.fn.jexcel.defaults[e].columns[n].options=[]),$.fn.jexcel.defaults[e].columns[n].editor||($.fn.jexcel.defaults[e].columns[n].editor=null),$.fn.jexcel.defaults[e].columns[n].allowEmpty||($.fn.jexcel.defaults[e].columns[n].allowEmpty=!1),$.fn.jexcel.defaults[e].colWidths[n]||($.fn.jexcel.defaults[e].colWidths[n]=$.fn.jexcel.defaults[e].defaultColWidth||"50"),$.fn.jexcel.defaults[e].colAlignments[n]||($.fn.jexcel.defaults[e].colAlignments[n]="center"),$.fn.jexcel.defaults[e].colHeaderClasses[n]||($.fn.jexcel.defaults[e].colHeaderClasses[n]=""),"autocomplete"==$.fn.jexcel.defaults[e].columns[n].type||"dropdown"==$.fn.jexcel.defaults[e].columns[n].type?$.fn.jexcel.defaults[e].columns[n].url&&l.push($.ajax({id:e,url:$.fn.jexcel.defaults[e].columns[n].url,index:n,dataType:"json",success:function(e){$.fn.jexcel.defaults[this.id].columns[this.index].source=e},error:function(e){console.error("It was not possible to load the url: "+this.url)}})):"calendar"==$.fn.jexcel.defaults[e].columns[n].type&&($.fn.jexcel.defaults[e].columns[n].options.format||($.fn.jexcel.defaults[e].columns[n].options.format="DD/MM/YYYY"));0<l.length?$.when.apply(this,l).done(function(){$("#"+e).jexcel("createTable")}):$("#"+e).jexcel("createTable")},createTable:function(){var e=$(this).prop("id"),n=$.fn.jexcel.defaults[e],l=document.createElement("table");$(l).prop("class","jexcel bossanova-ui"),$(l).prop("cellpadding","0"),$(l).prop("cellspacing","0"),n.tableId&&$(l).prop("id",n.tableId),$(l).prop("unselectable","yes"),$(l).prop("onselectstart","return false");var t=document.createElement("thead"),c=document.createElement("tbody");$(t).prop("class","jexcel_label");for(var s='<td width="30" class="jexcel_label"></td>',o=0;o<n.colHeaders.length;o++){var r=n.colWidths[o],a=n.colAlignments[o]||"center",i=n.colHeaderClasses[o]||"",d="hidden"==n.columns[o].type?" display:none":"",f=n.colHeaders[o];s+='<td id="col-'+o+'" width="'+r+'" align="'+a+'" title="'+f+'" class=" '+i+'"'+d+">"+(f||$.fn.jexcel("getColumnName",o))+"</td>"}if($(t).html("<tr>"+s+"</tr>"),$(l).append(t),$(l).append(c),$(this).html(l),!$(".jexcel_corner").length){var u=document.createElement("div");$(u).prop("class","jexcel_corner"),$(u).prop("id","jexcel_corner"),0==n.selectionCopy&&$(u).css("display","none");var p=document.createElement("textarea");$(p).prop("class","jexcel_textarea"),$(p).prop("id","jexcel_textarea");var x=document.createElement("div");$(x).css("display","none"),$(x).prop("class","jexcel_contextmenu"),$(x).prop("id","jexcel_contextmenu");var j=document.createElement("div");$(j).css("display","none"),$(j).prop("id","jexcel_about"),$(j).prop("class","jexcel_about"),$(j).html('<a href="http://github.com/paulhodel/jexcel">jExcel Spreadsheet</a>'),$("body").append(u),$("body").append(p),$("body").append(x),$("body").append(j),$(u).prop("unselectable","yes"),$(u).prop("onselectstart","return false"),$(u).prop("draggable","false"),$.fn.jexcel.dragStartControls=function(e){if($(e.target).parents(".jexcel").length)return!1},$(document).on("dragstart",$.fn.jexcel.dragStartControls),$.fn.jexcel.selectedCorner=!1,$.fn.jexcel.selectedHeader=null,$.fn.jexcel.resizeColumn=null,$.fn.jexcel.contextMenuControls=function(e){if("block"==$("#jexcel_contextmenu").css("display")&&$("#jexcel_contextmenu").css("display","none"),$.fn.jexcel.current){var l=$(e.target).parent().parent().parent();if($(l).is(".jexcel")){if($(e.target).parent().parent().is("thead"))var t=$(e.target).prop("id");else t=$(e.target).parent().prop("id");t&&(t=t.split("-"),contextMenuContent="","function"==typeof n.contextMenu?contextMenuContent=n.contextMenu(t[0],t[1]):$(e.target).parent().parent().is("thead")?(contextMenuContent+="<a onclick=\"jQuery('#"+$.fn.jexcel.current+"').jexcel('orderBy', "+t[1]+', 0)">Order ascending <span></span></a>',contextMenuContent+="<a onclick=\"jQuery('#"+$.fn.jexcel.current+"').jexcel('orderBy', "+t[1]+', 1)">Order descending <span></span></a><hr>',1==$.fn.jexcel.defaults[$.fn.jexcel.current].allowInsertColumn&&(contextMenuContent+="<a onclick=\"jQuery('#"+$.fn.jexcel.current+"').jexcel('insertColumn', 1, null, "+t[1]+')">Insert a new column<span></span></a>'),1==$.fn.jexcel.defaults[$.fn.jexcel.current].allowDeleteColumn&&(contextMenuContent+="<a onclick=\"jQuery('#"+$.fn.jexcel.current+"').jexcel('deleteColumn',"+t[1]+')">Delete this column<span></span></a>'),contextMenuContent+="<hr><a onclick=\"jQuery('#"+$.fn.jexcel.current+"').jexcel('download')\">Save as...<span>Ctrl + S</span></a>",n.about&&(contextMenuContent+="<a onclick=\"alert('"+n.about+"')\">About<span></span></a>")):$(e.target).parent().parent().is("tbody")&&(1==$.fn.jexcel.defaults[$.fn.jexcel.current].allowInsertColumn&&(contextMenuContent+="<a onclick=\"jQuery('#"+$.fn.jexcel.current+"').jexcel('insertColumn', 1, null, "+t[1]+')">Insert a new column<span></span></a>'),1==$.fn.jexcel.defaults[$.fn.jexcel.current].allowInsertRow&&(contextMenuContent+="<a onclick=\"jQuery('#"+$.fn.jexcel.current+"').jexcel('insertRow', 1, "+t[1]+')">Insert a new row<span></span></a><hr>'),1==$.fn.jexcel.defaults[$.fn.jexcel.current].allowDeleteRow&&(contextMenuContent+="<a onclick=\"jQuery('#"+$.fn.jexcel.current+"').jexcel('deleteRow',"+t[1]+')">Delete this row<span></span></a><hr>'),contextMenuContent+="<a onclick=\"jQuery('#"+$.fn.jexcel.current+"').jexcel('download')\">Save as...<span>Ctrl + S</span></a>",n.about&&(contextMenuContent+="<a onclick=\"alert('"+n.about+"')\">About<span></span></a>")),contextMenuContent&&($("#jexcel_contextmenu").html(contextMenuContent),$("#jexcel_contextmenu").css({display:"block",top:e.pageY+"px",left:e.pageX+"px"}),e.preventDefault()))}}},$(document).on("contextmenu",$.fn.jexcel.contextMenuControls),$.fn.jexcel.mouseWheelControls=function(e){$(".jexcel_contextmenu").css("display","none")},$(document).on("mousewheel",$.fn.jexcel.mouseWheelControls),$.fn.jexcel.mouseDownControls=function(e){if("jexcel_corner"==e.target.id)1==$.fn.jexcel.defaults[$.fn.jexcel.current].editable&&($.fn.jexcel.selectedCorner=!0);else{var l=$(e.target).parent().parent().parent();if($(l).is(".jexcel")){var t=$(l).parent().prop("id");if($.fn.jexcel.current&&$.fn.jexcel.current!=t&&$("#"+$.fn.jexcel.current).jexcel("updateSelection"),$.fn.jexcel.current=t,$(e.target).parent().parent().is("thead")){if(o=$(e.target).prop("id")){if(o=o.split("-"),$.fn.jexcel.selectedHeader&&(e.shiftKey||e.ctrlKey))var n=$($.fn.jexcel.selectedHeader).prop("id").split("-");else{n=$(e.target).prop("id").split("-");$.fn.jexcel.selectedHeader=$(e.target),$.fn.jexcel.selectedRow=null}if($(e.target).outerWidth()-e.offsetX<8)1==$.fn.jexcel.defaults[$.fn.jexcel.current].columnResize&&($.fn.jexcel.resizeColumn={mousePosition:e.pageX,column:o[1],width:parseInt($(e.target).css("width"))},$(l).parent().find(".c"+o[1]).addClass("resizing"),$(l).parent().find("#col-"+o[1]).addClass("resizing"),$("#"+$.fn.jexcel.current).jexcel("updateSelection"),$(".jexcel_corner").css("left","-200px"));else{var c=$("#"+$.fn.jexcel.current).find("#"+o[1]+"-0"),s=$("#"+$.fn.jexcel.current).find("#"+n[1]+"-"+parseInt($.fn.jexcel.defaults[$.fn.jexcel.current].data.length-1));$("#"+$.fn.jexcel.current).jexcel("updateSelection",c,s,1),$.fn.jexcel.selectedCell=$(c)}}}else $.fn.jexcel.selectedHeader=!1;if($(e.target).parent().parent().is("tbody"))if($(e.target).is(".jexcel_label"))if(1==$.fn.jexcel.defaults[$.fn.jexcel.current].rowDrag&&$(e.target).outerWidth()-e.offsetX<8)$("#"+$.fn.jexcel.current).jexcel("resetSelection"),$.fn.jexcel.dragRowFrom=$(e.target).parent().prop("id"),$.fn.jexcel.dragRowOver=$(e.target).parent().prop("id"),$(e.target).parent().find("td").css("background-color","rgba(0,0,0,0.1)");else{var o=$(e.target).parent().prop("id").split("-");if($.fn.jexcel.selectedRow&&(e.shiftKey||e.ctrlKey))n=$($.fn.jexcel.selectedRow).prop("id").split("-");else{n=$(e.target).parent().prop("id").split("-");$.fn.jexcel.selectedRow=$(e.target).parent(),$.fn.jexcel.selectedHeader=null}c=$("#"+$.fn.jexcel.current).find("#0-"+o[1]),s=$("#"+$.fn.jexcel.current).find("#"+parseInt($.fn.jexcel.defaults[$.fn.jexcel.current].columns.length-1)+"-"+n[1]);$("#"+$.fn.jexcel.current).jexcel("updateSelection",c,s),$.fn.jexcel.selectedCell=$(s)}else $($.fn.jexcel.selectedCell).hasClass("edition")?$(e.target)!=$.fn.jexcel.selectedCell&&($.fn.jexcel.selectedCell=$(e.target),$("#"+$.fn.jexcel.current).jexcel("updateSelection",$.fn.jexcel.selectedCell,$(e.target))):($.fn.jexcel.selectedCell&&e.shiftKey||($.fn.jexcel.selectedCell=$(e.target)),$("#"+$.fn.jexcel.current).jexcel("updateSelection",$.fn.jexcel.selectedCell,$(e.target))),$.fn.jexcel.selectedRow=null}else $(e.target).parents(".jexcel").length||e.target!=$("html").get(0)&&$("#"+$.fn.jexcel.current).jexcel("resetSelection")}},$(document).on("mousedown touchstart",$.fn.jexcel.mouseDownControls),$.fn.jexcel.mouseUpControls=function(e){if("jexcel_arrow"==e.target.id)$.fn.jexcel.current||($.fn.jexcel.current=$(e.target).parents(".jexcel").parent().prop("id")),$.fn.jexcel.selectedCell=$(e.target).parent().parent(),$("#"+$.fn.jexcel.current).jexcel("updateSelection",$.fn.jexcel.selectedCell,$.fn.jexcel.selectedCell),$("#"+$.fn.jexcel.current).jexcel("openEditor",$.fn.jexcel.selectedCell);else{3!=e.which&&$("#jexcel_contextmenu").css("display","none"),$.fn.jexcel.selectedCorner=!1,$.fn.jexcel.resizeColumn&&("function"==typeof $.fn.jexcel.defaults[$.fn.jexcel.current].onresize&&$.fn.jexcel.defaults[$.fn.jexcel.current].onresize($(this),$.fn.jexcel.resizeColumn.column,$.fn.jexcel.resizeColumn.width),$("#"+$.fn.jexcel.current).find("thead td").removeClass("resizing"),$("#"+$.fn.jexcel.current).find("tbody td").removeClass("resizing"),$.fn.jexcel.resizeColumn=null);var l=$("#"+$.fn.jexcel.current).find("tbody td.selection");if(0<$(l).length){var t=$(l[0]).prop("id").split("-"),n=$(l[l.length-1]).prop("id").split("-");$("#"+$.fn.jexcel.current).jexcel("copyData",t,n),$(l).removeClass("selection selection-left selection-right selection-top selection-bottom")}}if($.fn.jexcel.dragRowFrom){if($.fn.jexcel.dragRowFrom!=$.fn.jexcel.dragRowOver){var c=$.fn.jexcel.dragRowFrom.split("-"),s=$.fn.jexcel.dragRowOver.split("-");$("#"+$.fn.jexcel.current).jexcel("moveRow",c[1],s[1])}$("#"+$.fn.jexcel.dragRowFrom).css("cursor",""),$("#"+$.fn.jexcel.dragRowOver).css("cursor",""),$("#"+$.fn.jexcel.current+" #"+$.fn.jexcel.dragRowOver).parent().find("td").css("background-color","")}$.fn.jexcel.dragRowFrom=null,$.fn.jexcel.dragRowOver=null},$(document).on("mouseup",$.fn.jexcel.mouseUpControls),$.fn.jexcel.doubleClickControls=function(e){if($.fn.jexcel.current){if(1==$.fn.jexcel.defaults[$.fn.jexcel.current].editable){if("jexcel_corner"==e.target.id){var l=$("#"+$.fn.jexcel.current).find("tbody td.highlight");if("object"==typeof l){var t=$(l[0]).prop("id").split("-"),n=$(l[l.length-1]).prop("id").split("-");t[1]=parseInt(n[1])+1,n[1]=parseInt($.fn.jexcel.defaults[$.fn.jexcel.current].data.length),$("#"+$.fn.jexcel.current).jexcel("copyData",t,n)}}$(e.target).is(".highlight")&&$("#"+$.fn.jexcel.current).jexcel("openEditor",$(e.target))}if(1==$.fn.jexcel.defaults[$.fn.jexcel.current].columnSorting)if($(e.target).parent().parent().is("thead"))(t=$(e.target).prop("id"))&&(t=$(e.target).prop("id").split("-"),$("#"+$.fn.jexcel.current).jexcel("orderBy",t[1]))}},$(document).on("dblclick touchend",$.fn.jexcel.doubleClickControls),$.fn.jexcel.mouseMoveControls=function(e){if($.fn.jexcel.current){if(1==$.fn.jexcel.defaults[$.fn.jexcel.current].columnResize)if($.fn.jexcel.resizeColumn){var l=e.pageX-$.fn.jexcel.resizeColumn.mousePosition;0<$.fn.jexcel.resizeColumn.width+l&&$("#"+$.fn.jexcel.current).jexcel("setWidth",$.fn.jexcel.resizeColumn.column,$.fn.jexcel.resizeColumn.width+l)}else $(e.target).parent().parent().is("thead")&&($(e.target).outerWidth()-e.offsetX<8&&""!=$(e.target).prop("id")?$(e.target).css("cursor","col-resize"):"col-resize"==$(e.target).css("cursor")&&$(e.target).css("cursor",""));1==$.fn.jexcel.defaults[$.fn.jexcel.current].rowDrag&&$(e.target).parent().parent().is("tbody")&&$(e.target).is(".jexcel_label")&&($(e.target).outerWidth()-e.offsetX<8?$(e.target).css("cursor","all-scroll"):"all-scroll"==$(e.target).css("cursor")&&$(e.target).css("cursor",""))}$.fn.jexcel.dragRowFrom?$("body").css("cursor","all-scroll"):"all-scroll"==$("body").css("cursor")&&$("body").css("cursor","")},$(document).on("mousemove",$.fn.jexcel.mouseMoveControls),$.fn.jexcel.mouseOverControls=function(e){if(!$.fn.jexcel.resizeColumn){var l=$(e.target).closest(".jexcel");if($.fn.jexcel.current==$(l).parent().prop("id")){if($(e.target).parent().parent().is("thead")&&$.fn.jexcel.selectedHeader&&e.buttons){var t=$($.fn.jexcel.selectedHeader).prop("id"),n=$(e.target).prop("id");if(t&&n){t=t.split("-"),n=n.split("-");var c=$("#"+$.fn.jexcel.current).find("#"+t[1]+"-0"),s=$("#"+$.fn.jexcel.current).find("#"+n[1]+"-"+parseInt($.fn.jexcel.defaults[$.fn.jexcel.current].data.length-1));$("#"+$.fn.jexcel.current).jexcel("updateSelection",c,s)}}if($(e.target).parent().parent().is("tbody"))if($(e.target).is(".jexcel_label"))if($.fn.jexcel.selectedRow){if(e.buttons){t=$($.fn.jexcel.selectedRow).prop("id"),n=$(e.target).parent().prop("id");if(t&&n){t=t.split("-"),n=n.split("-");c=$("#"+$.fn.jexcel.current).find("#0-"+t[1]),s=$("#"+$.fn.jexcel.current).find("#"+parseInt($.fn.jexcel.defaults[$.fn.jexcel.current].columns.length-1)+"-"+n[1]);$("#"+$.fn.jexcel.current).jexcel("updateSelection",c,s)}}}else $.fn.jexcel.dragRowFrom&&($("#"+$.fn.jexcel.current+" #"+$.fn.jexcel.dragRowOver).parent().find("td").css("background-color",""),$(e.target).parent().find("td").css("background-color","rgba(0,0,0,0.1)"),$.fn.jexcel.dragRowOver=$(e.target).parent().prop("id"));else $.fn.jexcel.selectedCell&&($($.fn.jexcel.selectedCell).hasClass("edition")||(1==$.fn.jexcel.selectedCorner?$("#"+$.fn.jexcel.current).jexcel("updateCornerSelection",$(e.target)):e.buttons&&$("#"+$.fn.jexcel.current).jexcel("updateSelection",$.fn.jexcel.selectedCell,$(e.target))))}}},$(document).on("mouseover",$.fn.jexcel.mouseOverControls),$.fn.jexcel.pasteControls=function(e){$.fn.jexcel.selectedCell&&($($.fn.jexcel.selectedCell).hasClass("edition")||e.originalEvent&&(1==$.fn.jexcel.defaults[$.fn.jexcel.current].editable&&$("#"+$.fn.jexcel.current).jexcel("paste",$.fn.jexcel.selectedCell,e.originalEvent.clipboardData.getData("text")),e.preventDefault()))},$(document).on("paste",$.fn.jexcel.pasteControls);var h=null;$.fn.jexcel.keyDownControls=function(e){if($.fn.jexcel.current){var l=null;if($.fn.jexcel.selectedCell){if(columnId=$($.fn.jexcel.selectedCell).prop("id").split("-"),37==e.which)$($.fn.jexcel.selectedCell).hasClass("edition")&&("text"==$.fn.jexcel.defaults[$.fn.jexcel.current].columns[columnId[0]].type||$.fn.jexcel.defaults[$.fn.jexcel.current].columns[columnId[0]].type),$($.fn.jexcel.selectedCell).hasClass("edition")||(e.ctrlKey?l=$($.fn.jexcel.selectedCell).parent().find("td").not(".jexcel_label").first():0<$($.fn.jexcel.current).jexcel("col")&&(l=$($.fn.jexcel.selectedCell).prev()),e.preventDefault());else if(39==e.which)$($.fn.jexcel.selectedCell).hasClass("edition")&&("text"==$.fn.jexcel.defaults[$.fn.jexcel.current].columns[columnId[0]].type||$.fn.jexcel.defaults[$.fn.jexcel.current].columns[columnId[0]].type),$($.fn.jexcel.selectedCell).hasClass("edition")||(l=e.ctrlKey?$($.fn.jexcel.selectedCell).parent().find("td").last():$($.fn.jexcel.selectedCell).next(),e.preventDefault());else if(38==e.which)$($.fn.jexcel.selectedCell).hasClass("edition")&&("text"!=$.fn.jexcel.defaults[$.fn.jexcel.current].columns[columnId[0]].type&&"numeric"!=$.fn.jexcel.defaults[$.fn.jexcel.current].columns[columnId[0]].type||$("#"+$.fn.jexcel.current).jexcel("closeEditor",$($.fn.jexcel.selectedCell),!0)),$($.fn.jexcel.selectedCell).hasClass("edition")||(l=e.ctrlKey?$($.fn.jexcel.selectedCell).parent().parent().find("tr").first().find("#"+columnId[0]+"-0"):$($.fn.jexcel.selectedCell).parent().prev().find("#"+columnId[0]+"-"+(columnId[1]-1)),e.preventDefault());else if(40==e.which)$($.fn.jexcel.selectedCell).hasClass("edition")&&("text"!=$.fn.jexcel.defaults[$.fn.jexcel.current].columns[columnId[0]].type&&"numeric"!=$.fn.jexcel.defaults[$.fn.jexcel.current].columns[columnId[0]].type||$("#"+$.fn.jexcel.current).jexcel("closeEditor",$($.fn.jexcel.selectedCell),!0)),$($.fn.jexcel.selectedCell).hasClass("edition")||(l=e.ctrlKey?$($.fn.jexcel.selectedCell).parent().parent().find("tr").last().find("#"+columnId[0]+"-"+($.fn.jexcel.defaults[$.fn.jexcel.current].data.length-1)):$($.fn.jexcel.selectedCell).parent().next().find("#"+columnId[0]+"-"+(parseInt(columnId[1])+1)),e.preventDefault());else if(36==e.which)$($.fn.jexcel.selectedCell).hasClass("edition")&&$("#"+$.fn.jexcel.current).jexcel("closeEditor",$($.fn.jexcel.selectedCell),!0),l=$($.fn.jexcel.selectedCell).parent().find("td").not(".jexcel_label").first(),e.preventDefault();else if(35==e.which)$($.fn.jexcel.selectedCell).hasClass("edition")&&$("#"+$.fn.jexcel.current).jexcel("closeEditor",$($.fn.jexcel.selectedCell),!0),l=$($.fn.jexcel.selectedCell).parent().find("td").last(),e.preventDefault();else if(27==e.which)$($.fn.jexcel.selectedCell).hasClass("edition")&&$("#"+$.fn.jexcel.current).jexcel("closeEditor",$($.fn.jexcel.selectedCell),!1);else if(13==e.which)$($.fn.jexcel.selectedCell).hasClass("edition")&&("calendar"==$.fn.jexcel.defaults[$.fn.jexcel.current].columns[columnId[0]].type?$("#"+$.fn.jexcel.current).find("editor").jcalendar("close",1):$("#"+$.fn.jexcel.current).jexcel("closeEditor",$($.fn.jexcel.selectedCell),!0)),1==$.fn.jexcel.defaults[$.fn.jexcel.current].allowInsertRow&&1==$.fn.jexcel.defaults[$.fn.jexcel.current].allowManualInsertRow&&columnId[1]==$.fn.jexcel.defaults[$.fn.jexcel.current].data.length-1&&$("#"+$.fn.jexcel.current).jexcel("insertRow"),l=$($.fn.jexcel.selectedCell).parent().next().find("#"+columnId[0]+"-"+(parseInt(columnId[1])+1)),e.preventDefault();else if(9==e.which)$($.fn.jexcel.selectedCell).hasClass("edition")&&("calendar"==$.fn.jexcel.defaults[$.fn.jexcel.current].columns[columnId[0]].type?$("#"+$.fn.jexcel.current).find("editor").jcalendar("close",1):$("#"+$.fn.jexcel.current).jexcel("closeEditor",$($.fn.jexcel.selectedCell),!0)),1==$.fn.jexcel.defaults[$.fn.jexcel.current].allowInsertColumn&&1==$.fn.jexcel.defaults[$.fn.jexcel.current].allowManualInsertColumn&&columnId[0]==$.fn.jexcel.defaults[$.fn.jexcel.current].data[0].length-1&&$("#"+$.fn.jexcel.current).jexcel("insertColumn"),$($.fn.jexcel.selectedCell).hasClass("edition")||(l=e.shiftKey?$($.fn.jexcel.selectedCell).prev():$($.fn.jexcel.selectedCell).next()),e.preventDefault();else if(46==e.which){if(1==$.fn.jexcel.defaults[$.fn.jexcel.current].editable&&!$($.fn.jexcel.selectedCell).hasClass("edition"))if($.fn.jexcel.selectedRow)confirm("Are you sure to delete the selected rows?")&&($("#"+$.fn.jexcel.current).jexcel("deleteRow"),$("#"+$.fn.jexcel.current).jexcel("resetSelection"));else if($.fn.jexcel.selectedHeader){if(confirm("Are you sure to delete the selected columns?")){var t=$("#"+$.fn.jexcel.current).find("thead.jexcel_label").find(".selected");$("#"+$.fn.jexcel.current).jexcel("deleteColumn",$(t).prop("id").split("-")[1],t.length),$("#"+$.fn.jexcel.current).jexcel("resetSelection")}}else $("#"+$.fn.jexcel.current).jexcel("setValue",$("#"+$.fn.jexcel.current).find(".highlight"),"")}else if(!e.metaKey||e.shiftKey||e.ctrlKey)if(e.ctrlKey){if(!e.shiftKey&&e.ctrlKey&&!$($.fn.jexcel.selectedCell).hasClass("edition"))if(65==e.which){var n=parseInt($.fn.jexcel.defaults[$.fn.jexcel.current].columns.length-1),c=parseInt($.fn.jexcel.defaults[$.fn.jexcel.current].data.length-1),s=$("#"+$.fn.jexcel.current).find("#0-0"),o=$("#"+$.fn.jexcel.current).find("#"+n+"-"+c);$("#"+$.fn.jexcel.current).jexcel("updateSelection",s,o),e.preventDefault()}else 83==e.which?($("#"+$.fn.jexcel.current).jexcel("download"),e.preventDefault()):89==e.which?($($.fn.jexcel.selectedCell).hasClass("edition")||$("#"+$.fn.jexcel.current).jexcel("redo"),e.preventDefault()):90==e.which?($($.fn.jexcel.selectedCell).hasClass("edition")||$("#"+$.fn.jexcel.current).jexcel("undo"),e.preventDefault()):67==e.which?($("#"+$.fn.jexcel.current).jexcel("copy",!0),e.preventDefault()):88==e.which?(1==$.fn.jexcel.defaults[$.fn.jexcel.current].editable?$("#"+$.fn.jexcel.current).jexcel("cut"):$("#"+$.fn.jexcel.current).jexcel("copy",!0),e.preventDefault()):86==e.which&&window.clipboardData&&(1==$.fn.jexcel.defaults[$.fn.jexcel.current].editable&&$("#"+$.fn.jexcel.current).jexcel("paste",$.fn.jexcel.selectedCell,window.clipboardData.getData("Text")),e.preventDefault())}else $.fn.jexcel.selectedCell&&1==$.fn.jexcel.defaults[$.fn.jexcel.current].editable&&"readonly"!=$.fn.jexcel.defaults[$.fn.jexcel.current].columns[columnId[0]].type&&($($.fn.jexcel.selectedCell).hasClass("edition")||(110==e.keyCode||32==e.keyCode||48<=e.keyCode&&e.keyCode<=57||65<=e.keyCode&&e.keyCode<=90||96<=e.keyCode&&e.keyCode<=105||186<=e.keyCode&&e.keyCode<=190?$("#"+$.fn.jexcel.current).jexcel("openEditor",$($.fn.jexcel.selectedCell),!0):113==e.keyCode&&($("#"+$.fn.jexcel.current).jexcel("openEditor",$($.fn.jexcel.selectedCell),!1),e.preventDefault())));else $($.fn.jexcel.selectedCell).hasClass("edition")||67==e.which&&($("#"+$.fn.jexcel.current).jexcel("copy",!0),e.preventDefault());l&&0<$(l).length&&"row"!=$(l).prop("id").substr(0,3)&&(e.shiftKey&&9!=e.which?(h||(h=$.fn.jexcel.selectedCell),s=h):(e.ctrlKey,h=null,s=l),o=l,$.fn.jexcel.selectedCell=l,$(l).focus(),$("#"+$.fn.jexcel.current).jexcel("updateSelection",s,o))}}},$(document).on("keydown",$.fn.jexcel.keyDownControls)}$(this).jexcel("setData",$.fn.jexcel.defaults[e].data)},setData:function(e,l){var t=$(this).prop("id");e&&("string"==typeof e&&(e=JSON.parse(e)),$.fn.jexcel.defaults[t].data=e),$.fn.jexcel.defaults[t].history=[],$.fn.jexcel.defaults[t].historyIndex=-1;var n=$.fn.jexcel.defaults[t].colHeaders.length,c=$.fn.jexcel.defaults[t].data.length,s=$.fn.jexcel.defaults[t].minDimensions[0],o=$.fn.jexcel.defaults[t].minDimensions[1],r=n<s?s:n,a=c<o?o:c;for(j=0;j<a;j++)for(i=0;i<r;i++)null==$.fn.jexcel.defaults[t].data[j]&&($.fn.jexcel.defaults[t].data[j]=[]),null==$.fn.jexcel.defaults[t].data[j][i]&&($.fn.jexcel.defaults[t].data[j][i]="");$.fn.jexcel.defaults[t].formula=[];var d=$(this).find("tbody");$(d).html("");var f=[];for(j=0;j<$.fn.jexcel.defaults[t].data.length;j++){for(tr=document.createElement("tr"),$(tr).prop("id","row-"+parseInt(j)),$(tr).append('<td class="jexcel_label">'+parseInt(j+1)+"</td>"),i=0;i<$.fn.jexcel.defaults[t].colHeaders.length;i++)td=$(this).jexcel("createCell",i,j),$(tr).append(td),f.push({col:i,row:j,cell:$(td),newValue:$.fn.jexcel.defaults[t].data[j][i],oldValue:""});$(d).append(tr)}$(this).jexcel("loadCells",f,!0),$(this).jexcel("updateAllCellsWithFormulas"),e&&1!=$.fn.jexcel.ignoreEvents&&"function"==typeof $.fn.jexcel.defaults[t].onload&&$.fn.jexcel.defaults[t].onload($(this))},updateSettings:function(n){var c=$(this),s=$(this).prop("id");if(n?$.fn.jexcel.defaults[s].updateSettingsOptions=n:$.fn.jexcel.defaults[s].updateSettingsOptions&&(n=$.fn.jexcel.defaults[s].updateSettingsOptions),n){var e=$(this).find(".jexcel tbody td").not(".jexcel_label");"function"==typeof n.cells?$.each(e,function(e,l){var t=$(l).prop("id").split("-");n.cells($(l),t[0],t[1])}):"function"==typeof n.table&&$.each(e,function(e,l){var t=$(l).prop("id").split("-");n.table($(c),$(l),t[0],t[1],$.fn.jexcel.defaults[s].data[t[1]][t[0]],$.fn.jexcel("getColumnNameFromId",[t[0],t[1]]))})}},openEditor:function(n,e){var c=$(this).prop("id"),s=$(this),o=$.fn.jexcel.defaults[c],r=$(n).prop("id").split("-");if(1==$(n).hasClass("readonly"));else if($.fn.jexcel.edition=$(n).html(),$.fn.jexcel.editionValue=$(this).jexcel("getValue",$(n)),o.columns[r[0]].editor)$(n).addClass("edition"),o.columns[r[0]].editor.openEditor(n);else if("checkbox"==o.columns[r[0]].type||"hidden"==o.columns[r[0]].type);else if("dropdown"==o.columns[r[0]].type){if($(n).addClass("edition"),"function"==typeof o.columns[r[0]].filter)var a=o.columns[r[0]].filter($(this),$(n),r[0],r[1],o.columns[r[0]].source);else a=o.columns[r[0]].source;var l="<select>";for(i=0;i<a.length;i++)"object"==typeof a[i]?(k=a[i].id,v=a[i].name):(k=a[i],v=a[i]),l+='<option value="'+k+'">'+v+"</option>";l+="</select>";var d=$(n).find("input").val();$(n).html(l);var t=$(n).find("select");$(t).change(function(){$(s).jexcel("closeEditor",$(this).parent(),!0)}),$(t).blur(function(){$(s).jexcel("closeEditor",$(this).parent(),!0)}),$(t).focus(),d&&$(t).val(d)}else if("calendar"==o.columns[r[0]].type){$(n).addClass("edition");d=$(n).find("input").val(),t=document.createElement("input");$(t).prop("class","editor"),$(t).css("width",$(n).width()),$(t).val($(n).text()),$(n).html(t),$(n).find(""),$(n).focus(),o.columns[r[0]].options.onclose=function(){$(s).jexcel("closeEditor",$(n),!0)},$(t).jcalendar(o.columns[r[0]].options),$(t).jcalendar("open",d)}else if("multiple"==o.columns[r[0]].type){showResult=function(e,t){$(f).html(""),$.each(e,function(e,l){"object"==typeof l?(name=l.name,c=l.id):(name=l,c=l),-1!=name.toLowerCase().indexOf(t.toLowerCase())&&(li=document.createElement("li"),$(li).prop("id",c),$(li).html('<input type="checkbox"> '+name),$(li).mousedown(function(e){$(this).parent().find("li").removeClass("selected"),$(this).addClass("selected")}),$(f).append(li))}),$(f).html()||$(f).html('<div style="padding:6px;">No result found</div>'),$(f).css("display","")},$(n).addClass("edition");l=$(n).text().trim(),d=$(n).find("input").val(),a=o.columns[r[0]].source;var f=document.createElement("div");$(f).prop("class","results"),$(f).prop("tabindex",r[0]),$(f).css("width",$(n).outerWidth()),showResult(a,""),$(n).html(f),$(f).focus(),$(f).blur(function(){$(s).jexcel("closeEditor",$(n),!1)})}else if("autocomplete"==o.columns[r[0]].type){l=$(n).text().trim(),d=$(n).find("input").val();showResult=function(e,t){$(f).html(""),$.each(e,function(e,l){"object"==typeof l?(name=l.name,c=l.id):(name=l,c=l),-1!=name.toLowerCase().indexOf(t.toLowerCase())&&(li=document.createElement("li"),$(li).prop("id",c),$(li).html(name),$(li).mousedown(function(e){$(this).parent().find("li").removeClass("selected"),$(this).addClass("selected"),$(s).jexcel("closeEditor",$(n),!0)}),c==d&&$(li).addClass("selected"),$(f).append(li))}),$(f).html()||$(f).html('<div style="padding:6px;">No result found</div>'),$(f).css("display","")},$(n).addClass("edition");t=document.createElement("input");if($(t).prop("class","editor"),$(t).css("width",$(n).width()),"function"==typeof o.columns[r[0]].filter)a=o.columns[r[0]].filter($(this),$(n),r[0],r[1],o.columns[r[0]].source);else a=o.columns[r[0]].source;f=document.createElement("div");$(f).prop("class","results"),$(f).css("width",$(n).outerWidth()),showResult(a,l.trim());var u=null;$(t).on("keyup",function(e){if(38==e.which){var l=$(f).find("li.selected");$(l).length&&($(l).removeClass("selected"),$(l).prev().addClass("selected"),$(f).scrollTop($(f).scrollTop()-26))}else if(40==e.which){l=$(f).find("li.selected");$(l).length?($(l).removeClass("selected"),$(l).next().addClass("selected"),$(f).scrollTop($(f).scrollTop()+26)):(l=$(f).find("li"),$(l[0]).addClass("selected"))}else{var t=$(this).val();u&&clearTimeout(u),u=setTimeout(function(){o.columns[r[0]].url?$.getJSON(o.columns[r[0]].url+"?q="+t+"&r="+$(s).jexcel("getRowData",r[1]).join(","),function(e){showResult(e,t)}):a&&showResult(a,t)},500)}}),$(n).html(t),$(n).append(f),$(t).focus(),$(t).val(l),$(t).blur(function(){$(s).jexcel("closeEditor",$(n),!1)})}else{if($(n).addClass("edition"),1==o.wordWrap||1==o.columns[r[0]].wordWrap)var p=$(n).find("textarea");else p=$(n).find("input");if($(p).length)l=$(p).val();else l=$(n).html();if(1==o.wordWrap||1==o.columns[r[0]].wordWrap)t=document.createElement("textarea");else t=document.createElement("input");$(t).prop("class","editor"),$(t).css("width",$(n).width()),$(t).css("height",$(n).height()),$(n).html(t),o.columns[r[0]].mask&&($.fn.masked?$(t).mask(o.columns[r[0]].mask,o.columns[r[0]].options):console.error("Jexcel: it was not possible to load the mask plugin.")),$(t).focus(),e||$(t).val(l),$(t).blur(function(){$(s).jexcel("closeEditor",$(this).parent(),!0)})}},closeEditor:function(e,l){$(e).removeClass("edition");var t=$(this).prop("id"),n=$.fn.jexcel.defaults[t],c=$(e).prop("id").split("-");if(1==l){if(n.columns[c[0]].editor)s=n.columns[c[0]].editor.closeEditor(e,l);else if("checkbox"==n.columns[c[0]].type||"hidden"==n.columns[c[0]].type);else if("dropdown"==n.columns[c[0]].type)var s=$(e).find("select").val();else if("autocomplete"==n.columns[c[0]].type){var o=$(e).find("li.selected");if(0<o.length)s=$(o).prop("id");else s=""}else if("calendar"==n.columns[c[0]].type)s=$(e).find(".jcalendar_value").val();else if("numeric"==n.columns[c[0]].type){"="!=(s=$(e).find(".editor").val()).substr(0,1)&&(s=""==s&&n.columns[c[0]].allowEmpty?"":Number(s)||0)}else s=$(e).find(".editor").val();var r=!!$.fn.jexcel.ignoreHistory;$.fn.jexcel.defaults[t].data[c[1]][c[0]]==s&&($.fn.jexcel.ignoreHistory=!0),$.fn.jexcel.defaults[t].data[c[1]][c[0]]=s,$(this).jexcel("updateCells",[{col:c[0],row:c[1],cell:$(e),newValue:s,oldValue:$.fn.jexcel.editionValue}]),$.fn.jexcel.ignoreHistory=r}else n.columns[c[0]].editor?n.columns[c[0]].editor.closeEditor(e,l):"calendar"==n.columns[c[0]].type||($(e).html($.fn.jexcel.edition),$.fn.jexcel.edition=null)},getCell:function(e){return e=$(this).jexcel("getIdFromColumnName",e),e=$(this).find("[id="+e+"]")},getValue:function(e){var l=null;if("object"!=typeof e&&(e=$(this).jexcel("getCell",e)),$(e).length){var t=$(this).prop("id"),n=$.fn.jexcel.defaults[t],c=$(e).prop("id").split("-");n.columns[c[0]].editor?l=n.columns[c[0]].editor.getValue(e):"checkbox"==n.columns[c[0]].type?l=$(e).find("input").val():"dropdown"==n.columns[c[0]].type||"autocomplete"==n.columns[c[0]].type||"calendar"==n.columns[c[0]].type?l=$(e).find("input").val():"currency"==n.columns[c[0]].type?l=$(e).html().replace(/\D/g,""):(l=$(e).find("input"),l=$(l).length?$(l).val():$(e).html())}return l},setValue:function(e,t,l){if("object"==typeof e)var n=$(e).prop("id");else{n=$(this).jexcel("getIdFromColumnName",e);e=$(this).jexcel("getCell",e)}if($(e).length){var c=$(this).prop("id"),s=($(this),[]),o=n.split("-");return $.each(e,function(e,l){s.push({col:o[0],row:o[1],cell:$(l),newValue:t,oldValue:$.fn.jexcel.defaults[c].data[o[1]][o[0]]})}),l=!!l,$(this).jexcel("updateCells",s,l),!0}return!1},loadCells:function(e,l){var t=!!$.fn.jexcel.ignoreEvents,n=!!$.fn.jexcel.ignoreHistory;$.fn.jexcel.ignoreEvents=!0,$.fn.jexcel.ignoreHistory=!0,$(this).jexcel("updateCells",e,l),$.fn.jexcel.ignoreEvents=t,$.fn.jexcel.ignoreHistory=n},updateCells:function(e,t){var l=$(this).prop("id"),n=$(this),c=$.fn.jexcel.defaults[l];$.each(e,function(e,l){l.cell=$(n).find("#"+l.col+"-"+l.row),1!=$.fn.jexcel.ignoreEvents&&"function"==typeof c.onbeforechange&&c.onbeforechange(n,$(l.cell),l.oldValue,l.newValue),t=!!t,$(n).jexcel("updateCell",l,t),1!=$.fn.jexcel.ignoreEvents&&"function"==typeof c.onchange&&c.onchange(n,$(l.cell),l.newValue,l.oldValue)}),$(this).jexcel("afterChange"),$(this).jexcel("setHistory",e)},updateCell:function(e,l){var t=$(this).prop("id"),n=$.fn.jexcel.defaults[t],c=[e.col,e.row];if(value=""+e.newValue,1==$(e.cell).hasClass("readonly")&&0==l);else{if(n.columns[c[0]].editor)n.columns[c[0]].editor.setValue($(e.cell),value);else if("checkbox"==n.columns[c[0]].type)1==value||1==value||"true"==value?($(e.cell).find("input").prop("checked",!0),$(e.cell).find("input").prop("value",!0)):($(e.cell).find("input").prop("checked",!1),$(e.cell).find("input").prop("value",!1));else if("dropdown"==n.columns[c[0]].type||"autocomplete"==n.columns[c[0]].type){if(key="",val="",value){var s=[],o=n.columns[c[0]].source;for(num=0;num<o.length;num++)"object"==typeof o[num]?s[o[num].id]=o[num].name:s[o[num]]=o[num];s[value]?(key=value,val=s[value]):val=null}val||(val="&nbsp"),$(e.cell).html('<input type="hidden" value="'+key+'">'+val+'<span class="jexcel_arrow"><span id="jexcel_arrow"></span></span>')}else"calendar"==n.columns[c[0]].type?(val="","undefined"!=value?val=$.fn.jcalendar("label",value,n.columns[c[0]].options.format):val="",$(e.cell).html('<input type="hidden" value="'+value+'">'+val)):(val=value||"","="==value.substr(0,1)?($(this).jexcel("updateFormulas",e.col+"-"+e.row,value),$(e.cell).html('<input type="hidden" value="'+value+'">'+val)):"numeric"==n.columns[c[0]].type?$(e.cell).html('<input type="hidden" value="'+value+'">'+val):$(e.cell).html(val));$.fn.jexcel.defaults[t].data[c[1]][c[0]]=value;var r=$.fn.jexcel("getColumnName",e.col)+(parseInt(e.row)+1);value==Number(value)?window[r]=Number(value):window[r]=value,1!=$.fn.jexcel.ignoreEvents&&("="==value.substr(0,1)&&$(this).jexcel("executeFormula",e.col+"-"+e.row),Object.keys($.fn.jexcel.defaults[t].formula).length&&$(this).jexcel("formula",e.col+"-"+e.row))}},updateSelection:function(e,l,t){$(this);var n=$(this).prop("id");$.fn.jexcel.selectedCell=$(e);var c=$(this).find("tbody tr"),s=$(this).find("tbody td"),o=$(this).find("thead td"),r=0<$(this).find(".highlight").length,a=!1;if($(s).removeClass("highlight"),$(s).removeClass("highlight-left"),$(s).removeClass("highlight-right"),$(s).removeClass("highlight-top"),$(s).removeClass("highlight-bottom"),$(o).removeClass("selected"),$(c).removeClass("selected"),e&&l){if(or=$(e).prop("id").split("-"),de=$(l).prop("id").split("-"),parseInt(or[0])<parseInt(de[0]))var d=parseInt(or[0]),f=parseInt(de[0]);else d=parseInt(de[0]),f=parseInt(or[0]);if(parseInt(or[1])<parseInt(de[1]))var u=parseInt(or[1]),p=parseInt(de[1]);else u=parseInt(de[1]),p=parseInt(or[1]);for(i=d;i<=f;i++)for(j=u;j<=p;j++)$(this).find("#"+i+"-"+j).addClass("highlight"),$(this).find("#"+d+"-"+j).addClass("highlight-left"),$(this).find("#"+f+"-"+j).addClass("highlight-right"),$(this).find("#"+i+"-"+u).addClass("highlight-top"),$(this).find("#"+i+"-"+p).addClass("highlight-bottom"),$(this).find("#col-"+i).addClass("selected"),$(this).find("#row-"+j).addClass("selected");a=!0}1!=$.fn.jexcel.ignoreEvents&&($.fn.jexcel.defaults[n].onblur&&"function"==typeof $.fn.jexcel.defaults[n].onblur&&1==r&&0==a&&$.fn.jexcel.defaults[n].onblur($(this)),$.fn.jexcel.defaults[n].onfocus&&"function"==typeof $.fn.jexcel.defaults[n].onfocus&&0==r&&1==a&&$.fn.jexcel.defaults[n].onfocus($(this)),1==a&&$.fn.jexcel.defaults[n].onselection&&"function"==typeof $.fn.jexcel.defaults[n].onselection&&$.fn.jexcel.defaults[n].onselection($(this),e,l,t)),$.fn.jexcel.selection=e&&l?[e,l]:null,$(this).jexcel("updateCornerPosition")},resetSelection:function(){$.fn.jexcel.current&&$("#"+$.fn.jexcel.current).jexcel("updateSelection"),$(".jexcel_corner").css("left","-200px"),$.fn.jexcel.selectedRow=null,$.fn.jexcel.selectedCell=null,$.fn.jexcel.selectedHeader=null},getSelection:function(){if($.fn.jexcel.current)return $.fn.jexcel.selection},getCellCursor:function(){if($.fn.jexcel.current)return $.fn.jexcel.selectedCell},getSelectedCells:function(){if($.fn.jexcel.current)return $("#"+$.fn.jexcel.current).find("tbody td.highlight")},updateCornerSelection:function(e){$(this);var l=$(this).find("tbody td");$(l).removeClass("selection"),$(l).removeClass("selection-left"),$(l).removeClass("selection-right"),$(l).removeClass("selection-top"),$(l).removeClass("selection-bottom");var t=$(this).find("tbody td.highlight"),n=$(t[0]).prop("id").split("-"),c=$(t[t.length-1]).prop("id").split("-"),s=$(e).prop("id").split("-");if(s[1]>c[1]||s[1]<n[1]){var o=parseInt(n[0]),r=parseInt(c[0]);if(parseInt(s[1])>parseInt(c[1]))var a=parseInt(c[1])+1,d=parseInt(s[1]);else a=parseInt(s[1]),d=parseInt(n[1])-1}else if(s[0]>c[0]||s[0]<n[0]){a=parseInt(n[1]),d=parseInt(c[1]);if(parseInt(s[0])>parseInt(c[0]))o=parseInt(c[0])+1,r=parseInt(s[0]);else o=parseInt(s[0]),r=parseInt(n[0])-1}for(j=a;j<=d;j++)for(i=o;i<=r;i++)$(this).find("#"+i+"-"+j).addClass("selection"),$(this).find("#"+i+"-"+a).addClass("selection-top"),$(this).find("#"+i+"-"+d).addClass("selection-bottom"),$(this).find("#"+o+"-"+j).addClass("selection-left"),$(this).find("#"+r+"-"+j).addClass("selection-right")},updateCornerPosition:function(){var e=$(this).find(".highlight");if($(e).length){var l=$(e).last(),t=parseInt($(l).offset().top)+$(l).parent().outerHeight()-4,n=parseInt($(l).offset().left)+$(l).outerWidth()-4;$(".jexcel_corner").css("top",t),$(".jexcel_corner").css("left",n)}},getData:function(e){var l=[],t=0,n=0,c=$(this).find("thead tr td").not(":first").length,s=$(this).find("tbody tr").length;for(j=0;j<s;j++){for(t=0,i=0;i<c;i++)cell=$(this).find("#"+i+"-"+j),e&&!$(cell).hasClass("highlight")||(l[n]||(l[n]=[]),l[n][t]=$(this).jexcel("getValue",$(cell)),t++);0<t&&n++}return l},getRowData:function(e){var t=$(this),n=[];if(parseInt(e)){if(-1==e){var l=$(this).prop("id");e=$.fn.jexcel.defaults[l].data.length-1}}else e=0;var c=$(this).find("tbody .r"+e);return $.each(c,function(e,l){n.push($(t).jexcel("getValue",$(l)))}),n},getColumnData:function(e){var t=$(this),n=[];if(parseInt(e)){if(-1==e){var l=$(this).prop("id");e=$.fn.jexcel.defaults[l].columns.length-1}}else e=0;var c=$(this).find("tbody .c"+e);return $.each(c,function(e,l){n.push($(t).jexcel("getValue",$(l)))}),n},copy:function(e,l,t){l||(l="\t");var n="",c="",s="",o=!1,r=!1,a=$(this).find("thead tr td").not(":first").length,d=$(this).find("tbody tr").length;for(j=0;j<d;j++){for(c="",o=!1,i=0;i<a;i++)cell=$(this).find("#"+i+"-"+j),e&&!$(cell).hasClass("highlight")||(o&&(c+=l),((s=$(this).jexcel("getValue",$(cell))).match(/,/g)||s.match(/\n/))&&(s='"'+s+'"'),c+=s,o=!0);c&&(r&&(n+="\n"),n+=c,r=!0)}return t||(txt=$(".jexcel_textarea"),$(txt).val(n),$(txt).select(),document.execCommand("copy")),n},cut:function(){var e=$(this).find(".highlight");if(0<$(e).length){var n=[];$.each(e,function(e,l){var t=$(l).prop("id").split("-");n.push({col:t[0],row:t[1],cell:$(l),newValue:"",oldValue:$.fn.jexcel.defaults[$.fn.jexcel.current].data[t[1]][t[0]]})}),$(this).jexcel("copy",!0),$(this).jexcel("updateCells",n)}},paste:function(e,l){var t=$(this).prop("id"),n=(l=$(this).jexcel("parseCSV",l,"\t"),$(e).prop("id"));if(n){n=n.split("-");var c=parseInt(n[0]),s=parseInt(n[1]);s+l.length>$.fn.jexcel.defaults[t].data.length&&$(this).jexcel("insertRow",s+l.length-$.fn.jexcel.defaults[t].data.length),l[0]&&(row=l[0],c+row.length>$.fn.jexcel.defaults[t].data[s].length&&$(this).jexcel("insertColumn",c+row.length-$.fn.jexcel.defaults[t].data[s].length));var o=[];for(j=0;j<l.length;j++)for(row=l[j],i=0;i<row.length;i++)e=$(this).find("#"+(parseInt(i)+parseInt(c))+"-"+(parseInt(j)+parseInt(s))),0<$(e).length&&o.push({col:parseInt(i)+parseInt(c),row:parseInt(j)+parseInt(s),cell:$(e),newValue:row[i],oldValue:$.fn.jexcel.defaults[t].data[parseInt(j)+parseInt(s)][parseInt(i)+parseInt(c)]});0<o.length&&$(this).jexcel("updateCells",o)}},parseCSV:function(e,l){l=l||",";for(var t=new RegExp("(\\"+l+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+l+"\\r\\n]*))","gi"),n=[[]],c=!1;c=t.exec(e);){var s,o=c[1];o.length&&o!==l&&n.push([]),s=c[2]?c[2].replace(new RegExp('""',"g"),'"'):c[3],n[n.length-1].push(s)}return n},insertColumn:function(e,l,t){var n=$(this).prop("id"),c=$.fn.jexcel.defaults[n];if(1==c.allowInsertColumn){var s=[],o=[];0<e?numOfColumns=e:(numOfColumns=1,e&&(o=e));var r=c.colHeaders.length,a=0;if(null==t||t>=parseInt(r)){t=parseInt(r);a=1}l||(l=[]),l.columns||(l.columns=[]),l.colWidths||(l.colWidths=[]),l.colHeaders||(l.colHeaders=[]),l.colAlignments||(l.colAlignments=[]),l.colHeaderClasses||(l.colHeaderClasses=[]);for(var i=0;i<numOfColumns;i++)l.columns[i]||(l.columns[i]={type:"text"}),l.colWidths[i]||(l.colWidths[i]=50),l.colHeaders[i]||(l.colHeaders[i]=""),l.colAlignments[i]||(l.colAlignments[i]="center"),l.colHeaderClasses[i]||(l.colHeaderClasses[i]="");var d=c.columns.splice(t),f=c.colWidths.splice(t),u=c.colHeaders.splice(t),p=c.colAlignments.splice(t),x=c.colHeaderClasses.splice(t);i=0;for(var j=t;j<numOfColumns+t;j++)c.columns[j]=l.columns[i],c.colWidths[j]=l.colWidths[i],c.colHeaders[j]=l.colHeaders[i],c.colAlignments[j]=l.colAlignments[i],c.colHeaderClasses[j]=l.colHeaderClasses[i],c.columns[j].source||($.fn.jexcel.defaults[n].columns[j].source=[]),c.columns[j].options||($.fn.jexcel.defaults[n].columns[j].options=[]),i++;if(Array.prototype.push.apply(c.columns,d),Array.prototype.push.apply(c.colWidths,f),Array.prototype.push.apply(c.colHeaders,u),Array.prototype.push.apply(c.colAlignments,p),Array.prototype.push.apply(c.colHeaderClasses,x),1==a){var h=$(this).find("thead").find("#col-"+(t-1));for(j=numOfColumns+t-1;t<=j;j--){var m=(w=c.colHeaders[j])||$.fn.jexcel("getColumnName",j),g="hidden"==c.columns[j].type?" display:none":"";td='<td width="'+c.colWidths[j]+'" align="'+c.colAlignments[j]+'" title="'+w+'" class="'+c.colHeaderClasses[j]+'"'+g+">"+m+"</td>",$(h).after(td)}for(var v=0;v<c.data.length;v++){var C=$.fn.jexcel.defaults[n].data[v].splice(t),y=$(this).find("tbody").find("#row-"+v).find(".c"+(t-1));for(j=numOfColumns+t-1;t<=j;j--)td=$(this).jexcel("createCell",j,v),$(y).after(td),$.fn.jexcel.defaults[n].data[v][j]=o[v]?o[v]:"",s.push({col:j,row:v,cell:$(td),newValue:$.fn.jexcel.defaults[n].data[v][j],oldValue:""});Array.prototype.push.apply($.fn.jexcel.defaults[n].data[v],C)}}else{for(h=$(this).find("thead").find("#col-"+t),j=t;j<numOfColumns+t;j++){var w;m=(w=c.colHeaders[j])||$.fn.jexcel("getColumnName",j),g="hidden"==c.columns[j].type?" display:none":"";td='<td width="'+c.colWidths[j]+'" align="'+c.colAlignments[j]+'" title="'+w+'" class="'+c.colHeaderClasses[j]+'"'+g+">"+m+"</td>",$(h).before(td)}for(v=0;v<c.data.length;v++){for(C=$.fn.jexcel.defaults[n].data[v].splice(t),y=$(this).find("tbody").find("#row-"+v).find(".c"+t),j=t;j<numOfColumns+t;j++)td=$(this).jexcel("createCell",j,v),$(y).before(td),$.fn.jexcel.defaults[n].data[v][j]=o[v]?o[v]:"",s.push({col:j,row:v,cell:$(td),newValue:$.fn.jexcel.defaults[n].data[v][j],oldValue:""});Array.prototype.push.apply($.fn.jexcel.defaults[n].data[v],C)}}$(this).jexcel("updateTableReferences",t,0),$(this).jexcel("updateSelection",s[0].cell,s[s.length-1].cell),$(this).jexcel("loadCells",s,!0),$(this).jexcel("setHistory",s,{type:"insertColumn",mixed:e,properties:l,columnNumber:t}),1!=$.fn.jexcel.ignoreEvents&&"function"==typeof c.oninsertcolumn&&c.oninsertcolumn($(this))}},insertRow:function(e,l){var t=$(this),n=$(this).prop("id"),c=$.fn.jexcel.defaults[n];if(1==c.allowInsertRow){var s=[],o=[];if(0<e)var r=e;else{r=1;e&&(o=e)}var a=c.data.length,i=0;if(null==l||l>=parseInt(a)){l=parseInt(a);i=1}var d=$.fn.jexcel.defaults[n].data.splice(l);if(1==i)var f=$(this).find("tbody").find("#row-"+(l-1));else f=$(this).find("tbody").find("#row-"+l);var u=function(){var e=document.createElement("tr");$(e).append('<td class="jexcel_label"></td>'),$.fn.jexcel.defaults[n].data[p]=[];for(var l=0;l<$.fn.jexcel.defaults[n].colHeaders.length;l++)$.fn.jexcel.defaults[n].data[p][l]=o[l]?o[l]:"",td=$(t).jexcel("createCell",l,p),$(e).append(td),s.push({col:l,row:p,cell:$(td),newValue:$.fn.jexcel.defaults[n].data[p][l],oldValue:""});return e};if(1==i)for(var p=r+l-1;l<=p;p--)$(f).after(u());else for(p=l;p<r+l;p++)$(f).before(u());Array.prototype.push.apply($.fn.jexcel.defaults[n].data,d),$(this).jexcel("updateTableReferences"),$(this).jexcel("updateSelection",s[0].cell,s[s.length-1].cell),$(this).jexcel("loadCells",s,!0),$(this).jexcel("setHistory",s,{type:"insertRow",mixed:e,rowNumber:l}),1!=$.fn.jexcel.ignoreEvents&&"function"==typeof c.oninsertrow&&c.oninsertrow($(this))}},deleteColumn:function(e,l){var t=$(this).prop("id"),n=$.fn.jexcel.defaults[t];if(1==n.allowDeleteColumn){var c=[];if(null==e){var s=$(this).jexcel("getSelectedColumns");s[0]?(e=parseInt(s[0]),l=parseInt(s.length)):(e=$.fn.jexcel.defaults[t].data[0].length-1,l=1)}if(-1==e&&(e=$.fn.jexcel.defaults[t].data[0].length-1),l!=parseInt(l)&&(l=1),l>n.data[0].length-e&&(l=n.data[0].length-e),1<n.data[0].length){if(-1<parseInt(e)){for(var o=n.columns.splice(e,l),r=n.colHeaders.splice(e,l),a=n.colWidths.splice(e,l),i=n.colAlignments.splice(e,l),d=n.colHeaderClasses.splice(e,l),f=0;f<$.fn.jexcel.defaults[t].data.length;f++){data=n.data[f].splice(e,l);for(var u=0;u<l;u++)c[u]||(c[u]=[]),c[u].push(data[u])}var p=!1;for(u=e;u<e+l;u++){var x=$(this).find("thead #col-"+u);$(x).hasClass("selected")&&(p=!0),$(x).remove(),$(this).find("tbody .c"+u).remove()}if($(this).jexcel("updateTableReferences",e,0),p){var j=$(this).find("#0-0"),h=$(this).find("#0-0");$(this).jexcel("updateSelection",j,h)}}$(this).jexcel("setHistory",null,{type:"deleteColumn",columnNumber:e,numOfColumns:l,columnData:c,columnProperties:{columns:o,colHeaders:r,colWidths:a,colAlignments:i,colHeaderClasses:d}}),1!=$.fn.jexcel.ignoreEvents&&"function"==typeof n.ondeletecolumn&&n.ondeletecolumn($(this))}else console.error("It is not possible to delete the last column")}},deleteRow:function(e,l){var t=$(this).prop("id"),n=$.fn.jexcel.defaults[t];if(1==n.allowDeleteRow){var c=[];if(null==e){var s=$(this).jexcel("getSelectedRows");s[0]?(e=parseInt(s[0]),l=parseInt(s.length)):(e=$.fn.jexcel.defaults[t].data.length-1,l=1),e=parseInt(s[0]),l=parseInt(s.length)}if(-1==e&&(e=$.fn.jexcel.defaults[t].data.length-1),l!=parseInt(l)&&(l=1),l>n.data.length-e&&(l=n.data.length-l),1<n.data.length){if(-1<parseInt(e)){for(var o=!1,r=e;r<e+l;r++){c[r]=$.fn.jexcel.defaults[t].data[r];var a=$(this).find("#row-"+r);$(a).hasClass("selected")&&(o=!0),$(a).remove()}if($.fn.jexcel.defaults[t].data.splice(parseInt(e),l),$(this).jexcel("updateTableReferences",0,e),o){var i=$(this).find("#0-0"),d=$(this).find("#0-0");$(this).jexcel("updateSelection",i,d)}$(this).jexcel("setHistory",null,{type:"deleteRow",rowNumber:e,numOfRows:l,rowData:c}),1!=$.fn.jexcel.ignoreEvents&&"function"==typeof n.ondeleterow&&n.ondeleterow($(this))}}else console.error("It is not possible to delete the last row")}},setWidth:function(e,l){if(0<l){"object"==typeof e&&(e=(e=$(e).prop("id").split("-"))[0]);var t=$(this).find("thead #col-"+e);t.length&&$(t).prop("width",l)}},getWidth:function(e){"object"==typeof e&&(e=(e=$(e).prop("id").split("-"))[0]);var l=$(this).find("thead #col-"+e);if(l.length)return $(l).prop("width")},getHeader:function(e){var l=$(this).find("thead #col-"+e);if(l.length)return $(l).html()},getHeaders:function(e){var l=$(this).find("thead td").not(".jexcel_label"),t=[];return $.each(l,function(e,l){t.push($(l).text())}),1==e&&(t=t.join(",")),t},setHeader:function(e,l){if(l){var t=$(this).find("thead #col-"+e);t.length&&$(t).html(l)}},setSource:function(e,l){"object"==typeof e&&(e=(e=$(e).prop("id").split("-"))[0]);var t=$(this).prop("id");$.fn.jexcel.defaults[t].columns[e].source=l},afterChange:function(e){var l=$(this).prop("id");e||$(this).jexcel("spareCheck"),$(this).jexcel("updateCornerPosition"),$(this).jexcel("updateSettings"),1!=$.fn.jexcel.ignoreEvents&&"function"==typeof $.fn.jexcel.defaults[l].onafterchange&&$.fn.jexcel.defaults[l].onafterchange($(this))},copyData:function(e,l){var t=$(this).jexcel("getData",!0),n=parseInt(e[0]),c=parseInt(l[0]),s=parseInt(e[1]),o=parseInt(l[1]),r=[],a=0,d=0;for(j=s;j<=o;j++){for(null==t[d]&&(d=0),a=0,i=n;i<=c;i++)null==t[d]?a=0:null==t[d][a]&&(a=0),cell=$(this).find("#"+i+"-"+j),$(cell).length&&!$(cell).hasClass("readonly")&&r.push({col:i,row:j,cell:$(cell),newValue:t[d][a],oldValue:$.fn.jexcel.defaults[$.fn.jexcel.current].data[j][i]}),a++;d++}0<r.length&&$(this).jexcel("updateCells",r)},orderBy:function(e,l){if(0<=e){var t=$(this).find("#col-"+e).parent();if("0"!=l&&"1"!=l){var n=$(t).find(".arrow-down");l=0<$(n).length?1:0}$(t).find(".arrow-down").remove(),$(t).find(".arrow-up").remove(),$(t).find("td").css("text-decoration","none"),1==l?$(t).find("#col-"+e).append('<span class="arrow-up"></span>').css("text-decoration","underline"):$(t).find("#col-"+e).append('<span class="arrow-down"></span>').css("text-decoration","underline"),$(".jexcel_corner").css("top","-200px"),$(".jexcel_corner").css("left","-200px");var c=$(this).prop("id"),o=$.fn.jexcel.defaults[c];return Array.prototype.sortBy=function(c,s){return this.slice(0).sort(function(e,l){var t=e[c],n=l[c];switch(o.columns[c].type){case"numeric":t=Number(t),n=Number(n)}return s?n<t?-1:t<n?1:0:n<t?1:t<n?-1:0})},o.data=o.data.sortBy(e,l),$(this).jexcel("setData",null,!0),1!=$.fn.jexcel.ignoreEvents&&"function"==typeof $.fn.jexcel.defaults[c].onsort&&$.fn.jexcel.defaults[c].onsort($(this),e,l),!0}},updateFormulas:function(t,e){if("object"==typeof excelFormulaUtilities){var n=$(this).prop("id"),l=excelFormulaUtilities.formula2JavaScript(e).match(/([A-Z]+[0-9]+)*/g);$.each(l,function(e,l){l&&(elementId=$.fn.jexcel("getIdFromColumnName",l),$.fn.jexcel.defaults[n].formula[elementId]||($.fn.jexcel.defaults[n].formula[elementId]=[]),elementId==t?console.error("Self reference error: "+l):$.fn.jexcel.defaults[n].formula[elementId].push(t))})}},formula:function(n){if("object"==typeof excelFormulaUtilities){var c=$(this).prop("id"),s=$(this);$.fn.jexcel.defaults[c].formula[n]&&$.each($.fn.jexcel.defaults[c].formula[n],function(e,l){var t=l.split("-");"="!=$.fn.jexcel.defaults[c].data[t[1]][t[0]].substr(0,1)?($(s).find("#"+l).removeClass("error"),$.fn.jexcel.defaults[c].formula[n].splice(e,1)):$(s).jexcel("executeFormula",l),$(s).jexcel("formula",l)})}else console.error("excelFormulaUtilities lib not included")},executeFormula:function(cellId){var id=$(this).prop("id"),cell=$(this).find("#"+cellId),cellId=cellId.split("-"),formula=$.fn.jexcel.defaults[id].data[cellId[1]][cellId[0]],value=eval(excelFormulaUtilities.formula2JavaScript(formula));if(null===value||null==value||""+value=="NaN")value='<input type="hidden" value="'+formula+'">#ERROR',$(cell).addClass("error"),$(cell).html(value);else{var letter=$.fn.jexcel("getColumnName",cellId[0])+(parseInt(cellId[1])+1);window[letter]=value,value='<input type="hidden" value="'+formula+'">'+value,$(cell).removeClass("error"),$(cell).html(value)}},updateAllCellsWithFormulas:function(){if("object"==typeof excelFormulaUtilities){var e=$(this).prop("id"),l=Object.keys($.fn.jexcel.defaults[e].formula);if(0<l.length)for(var t=0;t<l.length;t++)$(this).jexcel("formula",l[t])}},helper:function(e){var l=[];if("object"==typeof e&&"createEmptyData"==e.action){var t=e.cols||10,n=e.rows||100;for(j=0;j<n;j++)for(l[j]=[],i=0;i<t;i++)l[j][i]=""}return l},download:function(){var e=$(this).prop("id"),l=$.fn.jexcel.defaults[e],t="";1==l.csvHeaders&&(t=l.colHeaders.join()+"\n"),t+=$(this).jexcel("copy",!1,",",!0);var n=document.createElement("a"),c=new Blob([t],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(c);n.href=s,n.setAttribute("download",l.csvFileName+".csv"),n.click()},setHistory:function(e,l){if(1!=$.fn.jexcel.ignoreHistory){$(this);var t=$(this).prop("id"),n=++$.fn.jexcel.defaults[t].historyIndex,c=$.fn.jexcel.defaults[t].history=$.fn.jexcel.defaults[t].history.slice(0,n+1);c[n]=l?{action:l}:{firstSelected:e[0].cell,lastSelected:e[e.length-1].cell,cellChanges:e}}},undo:function(){var e=$(this).prop("id"),l=!!$.fn.jexcel.ignoreEvents,t=!!$.fn.jexcel.ignoreHistory;$.fn.jexcel.ignoreEvents=!0,$.fn.jexcel.ignoreHistory=!0;var n=[];if(0<=$.fn.jexcel.defaults[e].historyIndex){var c=$.fn.jexcel.defaults[e].history[$.fn.jexcel.defaults[e].historyIndex--];if(c.action)if("insertRow"==c.action.type){var s=c.action.rowNumber,o=0<c.action.mixed?c.action.mixed:1;$(this).jexcel("deleteRow",s,o)}else if("deleteRow"==c.action.type){s=c.action.rowNumber,o=c.action.numOfRows;for(var r=s;r<s+o;r++)$(this).jexcel("insertRow",c.action.rowData[r],r)}else if("insertColumn"==c.action.type){var a=c.action.columnNumber,i=0<c.action.mixed?c.action.mixed:1;$(this).jexcel("deleteColumn",a,i)}else if("deleteColumn"==c.action.type){a=c.action.columnNumber,i=c.action.numOfColumns;for(var d=c.action.columnProperties,f=0,u=a;u<a+i;u++)$(this).jexcel("insertColumn",c.action.columnData[f],{columns:[d.columns[f]],colHeaders:[d.colHeaders[f]],colWidths:[d.colWidths[f]],colAlignments:[d.colAlignments[f]],colHeaderClasses:[d.colHeaderClasses[f]]},u),f++}else"moveRow"==c.action.type&&$(this).jexcel("moveRow",c.action.to,c.action.fr);else{for(var p=0;p<c.cellChanges.length;p++)n.push({col:c.cellChanges[p].col,row:c.cellChanges[p].row,cell:c.cellChanges[p].cell,newValue:c.cellChanges[p].oldValue,oldValue:c.cellChanges[p].newValue});$.fn.jexcel.selectedCell=c.firstSelected,$(this).jexcel("updateSelection",c.firstSelected,c.lastSelected),$(this).jexcel("loadCells",n)}}$.fn.jexcel.ignoreEvents=l,$.fn.jexcel.ignoreHistory=t,$(this).jexcel("updateAllCellsWithFormulas"),$(this).jexcel("afterChange")},redo:function(){var e=$(this).prop("id"),l=!!$.fn.jexcel.ignoreEvents,t=!!$.fn.jexcel.ignoreHistory;if($.fn.jexcel.ignoreEvents=!0,$.fn.jexcel.ignoreHistory=!0,$.fn.jexcel.defaults[e].historyIndex<$.fn.jexcel.defaults[e].history.length-1){var n=$.fn.jexcel.defaults[e].history[++$.fn.jexcel.defaults[e].historyIndex];n.action?"insertRow"==n.action.type?$(this).jexcel("insertRow",n.action.mixed,n.action.rowNumber):"deleteRow"==n.action.type?$(this).jexcel("deleteRow",n.action.rowNumber,n.action.numOfRows):"insertColumn"==n.action.type?$(this).jexcel("insertColumn",n.action.mixed,n.action.properties,n.action.columnNumber):"deleteColumn"==n.action.type?$(this).jexcel("deleteColumn",n.action.columnNumber,n.action.numOfColumns):"moveRow"==n.action.type&&$(this).jexcel("moveRow",n.action.fr,n.action.to):($.fn.jexcel.selectedCell=n.firstSelected,$(this).jexcel("updateSelection",n.firstSelected,n.lastSelected),$(this).jexcel("loadCells",n.cellChanges))}$.fn.jexcel.ignoreEvents=l,$.fn.jexcel.ignoreHistory=t,$(this).jexcel("updateAllCellsWithFormulas"),$(this).jexcel("afterChange")},createCell:function(e,l){var t=$(this).prop("id"),n=$.fn.jexcel.defaults[t];return align=n.colAlignments[e],width=n.colWidths[e],td=document.createElement("td"),$(td).prop("width",width),$(td).prop("align",align),$(td).prop("id",e+"-"+l),$(td).addClass("c"+e),$(td).addClass("r"+l),"hidden"==n.columns[e].type?$(td).css("display","none"):"checkbox"==n.columns[e].type&&(1==n.columns[e].readOnly?$(td).html('<input type="checkbox" disabled="disabled">'):$(td).html('<input type="checkbox" onclick="var value = this.checked; var instance = $(this).parents(\'.jexcel\').parent(); $(instance).jexcel(\'setValue\', $(this).parent(), value);" value="false">')),1==n.columns[e].readOnly&&$(td).addClass("readonly","readonly"),1!=n.wordWrap&&1!=n.columns[e].wordWrap||$(td).css("white-space","pre"),n.columns[e].cssClass&&$(td).addClass(n.columns[e].cssClass),$(td)},spareCheck:function(){var e=$(this).prop("id"),l=!1;if(0<$.fn.jexcel.defaults[e].minSpareCols){lastCol=$.fn.jexcel.defaults[e].data[0]?$.fn.jexcel.defaults[e].data[0].length:0,lastRow=$.fn.jexcel.defaults[e].data.length,checkPoint=lastCol-$.fn.jexcel.defaults[e].minSpareCols,checkPoint<0&&(checkPoint=0),l=!1;for(var t=0;t<lastRow;t++)for(var n=checkPoint;n<lastCol;n++)$.fn.jexcel.defaults[e].data[t][n]&&(l=!0);l&&$(this).jexcel("insertColumn",$.fn.jexcel.defaults[e].minSpareCols)}if(0<$.fn.jexcel.defaults[e].minSpareRows){lastCol=$.fn.jexcel.defaults[e].data[0]?$.fn.jexcel.defaults[e].data[0].length:0,lastRow=$.fn.jexcel.defaults[e].data.length,checkPoint=lastRow-$.fn.jexcel.defaults[e].minSpareRows,checkPoint<0&&(checkPoint=0),l=!1;for(t=checkPoint;t<lastRow;t++)for(n=0;n<lastCol;n++)$.fn.jexcel.defaults[e].data[t][n]&&(l=!0);l&&$(this).jexcel("insertRow",$.fn.jexcel.defaults[e].minSpareCols)}},getSelectedRows:function(){var t=[],e=$(this).find("tbody > tr.selected");return $.each(e,function(e,l){t.push($(l).prop("id").replace("row-",""))}),t},getSelectedColumns:function(){var t=[],e=$(this).find("thead > tr > td.selected");return $.each(e,function(e,l){t.push($(l).prop("id").replace("col-",""))}),t},getHeaderNumber:function(e){var l=!1;if(e){var t=$(this).find("thead td."+e);$(t).length&&(l=parseInt($(t).prop("id").replace("col-","")))}return l},updateTableReferences:function(o,t){var e=$(this),r=$(this).prop("id");o||(o=0),t||(t=0);var l=$(this).find("tbody > tr");if($.each(l,function(s,e){if(t<=s){$(e).prop("id","row-"+s);var l=$(e).find("td");$.each(l,function(e,l){if(0==e)$(l).html(parseInt(s)+1);else if(o<=e){var t=$(l).prop("id").split("-");$(l).prop("id",e-1+"-"+s),$(l).removeClass("r"+t[1]),$(l).addClass("r"+s),$(l).removeClass("c"+t[0]),$(l).addClass("c"+(e-1));var n=""+$.fn.jexcel.defaults[r].data[s][e-1];"="==n.substr(0,1)&&(t[0]!=e-1&&(n=$.fn.jexcel("shiftFormulaByColumn",n,e-1-t[0]),$.fn.jexcel.defaults[r].data[s][e-1]=n,$(l).find("input").val(n)),t[1]!=s&&(n=$.fn.jexcel("shiftFormulaByRow",n,s-t[1]),$.fn.jexcel.defaults[r].data[s][e-1]=n,$(l).find("input").val(n)));var c=$.fn.jexcel("getColumnNameFromId",[e-1,s]);n==Number(n)?window[c]=Number(n):window[c]=n}})}}),-1<o){var n=$(this).find("thead > tr > td");$.each(n,function(e,l){if(0<e&&o<=e&&($(l).prop("id","col-"+(e-1)),!$(l).prop("title"))){var t=$.fn.jexcel("getColumnName",e-1);$(l).html(t)}})}$.fn.jexcel.defaults[r].formula=[];for(var c=0;c<$.fn.jexcel.defaults[r].data.length;c++)for(var s=0;s<$.fn.jexcel.defaults[r].data[c].length;s++){var a=""+$.fn.jexcel.defaults[r].data[c][s];"="==a.substr(0,1)&&$(e).jexcel("updateFormulas",s+"-"+c,a)}$(this).jexcel("updateAllCellsWithFormulas"),$(this).jexcel("afterChange")},moveRow:function(e,l){var t=$(this).prop("id");$.fn.jexcel.defaults[t].data.splice(l,0,$.fn.jexcel.defaults[t].data.splice(e,1)[0]);var n=$(this).find("#row-"+e).clone();$(this).find("#row-"+e).remove(),l<e?$(this).find("#row-"+l).before(n):$(this).find("#row-"+l).after(n),$(this).jexcel("updateTableReferences",0,0),"function"==typeof $.fn.jexcel.defaults[t].onmoverow&&$.fn.jexcel.defaults[t].onmoverow($(this),e,l),$(this).jexcel("setHistory",null,{type:"moveRow",fr:e,to:l})},moveColumn:function(){},getColumnName:function(e){var l="";return 701<e?(l+=String.fromCharCode(64+parseInt(e/676)),l+=String.fromCharCode(64+parseInt(e%676/26))):25<e&&(l+=String.fromCharCode(64+parseInt(e/26))),l+=String.fromCharCode(65+e%26)},getIdFromColumnName:function(e,l){var t=/^[a-zA-Z]+/.exec(e);if(t){for(var n=0,c=0;c<t[0].length;c++)n+=parseInt(t[0].charCodeAt(c)-64)*Math.pow(26,t[0].length-1-c);--n<0&&(n=0);var s=parseInt(/[0-9]+$/.exec(e));0<s&&s--,e=1==l?[n,s]:n+"-"+s}return e},getColumnNameFromId:function(e){return Array.isArray(e)||(e=e.split("-")),$.fn.jexcel("getColumnName",e[0])+(parseInt(e[1])+1)},shiftFormulaByColumn:function(e,t){t||(t=1);for(var l=excelFormulaUtilities.formula2JavaScript(e).match(/([A-Z]+[0-9]+)*/g).filter(function(e){return""!=e}).sort(function(e,l){return e=$.fn.jexcel("getIdFromColumnName",e,!0),l=$.fn.jexcel("getIdFromColumnName",l,!0),0<t?l[0]-e[0]:e[0]-l[0]}),n=0;n<l.length;n++)if(l[n]){var c=$.fn.jexcel("getIdFromColumnName",l[n],!0),s=c[0]+t;s<0&&(s=0);var o=$.fn.jexcel("getColumnName",s);e=e.replace(new RegExp(l[n],"g"),o+(c[1]+1))}return e},shiftFormulaByRow:function(e,t){t||(t=1);for(var l=excelFormulaUtilities.formula2JavaScript(e).match(/([A-Z]+[0-9]+)*/g).filter(function(e){return""!=e}).sort(function(e,l){return e=$.fn.jexcel("getIdFromColumnName",e,!0),l=$.fn.jexcel("getIdFromColumnName",l,!0),0<t?l[1]-e[1]:e[1]-l[1]}),n=0;n<l.length;n++)if(l[n]){var c=$.fn.jexcel("getIdFromColumnName",l[n],!0),s=""+$.fn.jexcel("getColumnName",c[0]),o=c[1]+1+t;o<1&&(o=1),e=e.replace(new RegExp(l[n],"g"),s+o)}return e},row:function(e){e||(e=$.fn.jexcel.selectedCell);var l=!1;return $(e).length&&(l=(l=$(e).prop("id").split("-"))[1]),l},col:function(e){e||(e=$.fn.jexcel.selectedCell);var l=!1;return $(e).length&&(l=(l=$(e).prop("id").split("-"))[0]),l},getEventsFlag:function(e){return!!$.fn.jexcel.ignoreEvents},setEventsFlag:function(e){$.fn.jexcel.ignoreEvents=!!e},getHistoryFlag:function(e){return!!$.fn.jexcel.ignoreHistory},setHistoryFlag:function(e){$.fn.jexcel.ignoreHistory=!!e},destroy:function(){var e=$(this).prop("id");$.fn.jexcel.defaults[e]&&(delete $.fn.jexcel.defaults[e],$(this).html(""),$(".jexcel_corner").remove(),$(".jexcel_textarea").remove(),$(".jexcel_contextmenu").remove(),$(".jexcel_about").remove()),Object.keys($.fn.jexcel.defaults).length||($(document).off("dragstart",$.fn.jexcel.dragStartControls),$(document).off("contextmenu",$.fn.jexcel.contextMenuControls),$(document).off("mousewheel",$.fn.jexcel.mouseWheelControls),$(document).off("mousedown touchstart",$.fn.jexcel.mouseDownControls),$(document).off("mouseup",$.fn.jexcel.mouseUpControls),$(document).off("dblclick touchend",$.fn.jexcel.doubleClickControls),$(document).off("mousemove",$.fn.jexcel.mouseMoveControls),$(document).off("mouseover",$.fn.jexcel.mouseOverControls),$(document).off("paste",$.fn.jexcel.pasteControls),$(document).off("keydown",$.fn.jexcel.keyDownControls))}};$.fn.jexcel=function(e){return methods[e]?methods[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void $.error("Method "+e+" does not exist on jQuery.tooltip"):methods.init.apply(this,arguments)}}(jQuery);